# 演进中的架构
- 它们是什么、它们取代了什么、以及它们为什么能够在
斗争中取得成功，为什么变得不可或缺的支撑，又或者它们为什么会失败，在竞争中被淘
汰，或逐渐湮灭于历史的烟尘当中。
## 单体架构
![](../../../4三千道藏/media/Pasted%20image%2020211227104339.png)
### DDD模型
1. Resource：对应 DDD 中的 User Interface 层，负责向用户显示信息或者解释用户发出的命令。请注意，这里指的“用户”不一定是使用用户界面的人，可以是位于另一个进程或
计算机的服务。由于本工程采用了 MVVM 前后端分离模式，这里所指的用户实际上是前端的服务消费者，所以这里以 RESTful 中的核心概念“资源”（Resource）来命名。
2. Application：对应 DDD 中的 Application 层，负责定义软件本身对外暴露的能力，即软件本身可以完成哪些任务，并负责对内协调领域对象来解决问题。根据 DDD 的原则，
应用层要尽量简单，不包含任何业务规则或者知识，而只为下一层中的领域对象协调任务，分配工作，使它们互相协作，这一点在代码上表现为 Application 层中一般不会存
在任何的条件判断语句。在许多项目中，Application 层都会被选为包裹事务（代码进入此层事务开始，退出此层事务提交或者回滚）的载体。
3. Domain：对应 DDD 中的 Domain 层，负责实现业务逻辑，即表达业务概念，处理业务状态信息以及业务规则这些行为，此层是整个项目的重点。
4. Infrastructure：对应 DDD 中的 Infrastructure 层，向其他层提供通用的技术能力，譬如持久化能力、远程服务通讯
## 微服务: Spring Cloud
### “合理”下面的许多无可奈何之处：
- 制约软件质量与业务能力提升的最大因素是人而非硬件。
- 技术异构的需求从可选渐渐成为必须。很多时候为异构能力进行的分布式部署，并不是你想或者不想的问题，而是没有选择、无可避免的。
- 目标一：尽可能缩减非业务功能代码的比例。(针对业务而非技术)
在 Fenix's Bookstore 中，用户服务（Account）、商品服务（Warehouse）、交易服务
（Payment）三个工程是真正承载业务逻辑的，认证授权服务（Security）可以认为是同
时涉及到了技术与业务，而配置中心（Configuration）、网关（Gateway）和服务注册
中心（Registry）则是纯技术性。我们希望尽量消除这些纯技术的工程，以及那些依附
在其他业务工程上的纯技术组件。
- 目标二：尽可能在不影响原有的代码的前提下完成迁移。
得益于 Spring Framework 4 中的 Conditional Bean 等声明式特性的出现，对于近年来
新发布的 Java 技术组件，声明式编程 （Declarative Programming）已经逐步取代命
令式编程 （Imperative Programming）成为主流的选择。在声明式编程的支持下，我
们可以从目的而不是过程的角度去描述编码意图，使得代码几乎不会与具体技术实现产
生耦合，若要更换一种技术实现，只需要调整配置中的声明便可做到。
### 升级后
** 真正的区别在 Kubernetes的实现版本中直接删除了配置中心、服务注册中心的工程，在其他工程的 pom.xml 中也删
除了如 Eureka、Ribbon、Config 等组件的依赖。取而代之的是新增了若干以 YAML 配置文件为载体的Skaffold 和 Kubernetes 的资源描述，
这些资源描述文件，将会动态构建出 DNS 服务器、服务负载均衡器等一系列虚拟化的基础设施，去代替原有的应用层面的技术组件。**
![](../../../4三千道藏/media/Pasted%20image%2020211227143605.png)

| 组件     | Spring Cloud Kubernetes                                                                                                                                                                            |
| -------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 环境感知 | Kubernetes Client                                                                                                                                                                                  |
| 配置中心 | ConfigMap (动态更新)                                                                                                                                                                               |
| 服务发现 | Service 来管理，通过Spring Cloud Kubernetes Discovery 自动将 HTTP 访问中的服务转换为FQDN                                                                                                           |
| 负载均衡 | 采用 Kubernetes Service 本身的负载均衡能力实现（就是 DNS 负载均衡），可以不再需要 Ribbon 这样的客户端负载均衡了                                                                                    |
| 服务网关 | 未采用 Ingress 代替。这里有两点考虑，一是 Ingress Controller 不算是 Kubernetes 的自带组件，它可以有不同的选择（KONG、Nginx、Haproxy，等等）                                                        |
| 服务熔断 | 仍然采用 Hystrix，Kubernetes 本身无法做到精细化的服务治理，包括熔断、流控、监视                                                                                                                    |
| 认证授权 | Spring Security OAuth 2，Kubernetes 的 RBAC 授权可以解决服务层面的访问控制问题，但 Security 是跨越了业务和技术的边界的，认证授权模块本身仍承担着对前端用户的认证、授权职责，这部分是与业务相关的。 |

### 服务网格Istio
即通过中间人流量劫持的方式，以介乎于应用和基础设施之间的边车代理（Sidecar）来做到既让用户代码可以专注业务需求，不必关注分布式的技术，
又能实现几乎不亚于此前 Spring Cloud 时代的那种通过代码来解决分布式问题的可配置、安全和可观测性。
- 目标一：实现在大规模虚拟服务下可管理、可观测的系统。必须找到某种方法，针对应用系统整体层面，而不是针对单一微服务来连接、调度、配
置和观测服务的执行情况。此时，可视化整个系统的服务调用关系，动态配置调节服务节点的断路、重试和均衡参数，
针对请求统一收集服务间的处理日志等功能就不再是系统锦上添花的外围功能了，而是关乎系统是否能够正常运行、运维的必要支撑点。
- 目标二：在代码层面，裁剪技术栈深度，回归单体架构中基于 Spring Boot 的开发模式，而不是 Spring Cloud 或者 Spring Cloud Kubernetes 的技术架构。
我们并不是要去开历史的倒车，相反，我们是很贪心地希望开发重新变得简单的同时，又不能放弃现在微服务带来的一切好处。
在这个版本的 Fenix's Bookstore 里，所有与 Spring Cloud 相关的技术组件，如上个版本遗留的 Zuul 网关、Hystrix 断路器，还有上个
版本新引入用于感知适配 Kubernetes 环境的 Spring Cloud Kubernetes 都将会被拆除掉。如果只观察单个微服务的技术堆栈，它与最初的单体架构几乎没有任何不同——甚至还更加简单了，
连从单体架构开始一直保护着服务调用安全的 Spring Security 都移除掉（由于 Fenix's Bookstore 借用了 Spring Security OAuth2 的密码模式做为登陆服务的
端点，所以在 Jar 包层面 Spring Security 还是存在的，但其用于安全保护的 Servlet 和 Filter 已经被关闭掉）
![](../../../4三千道藏/media/Pasted%20image%2020211228182557.png)
## 微服务:Kubernetes

# 架构师的视角
- 做架构设计时思考哪些问题，有哪
些主流的解决方案和行业标准做法，各种方案有什么优点、缺点，不同的解决方法会带来
什么不同的影响，
# 分布式的基石
- 只要选择了分布式架构，无论是 SOA、微服务、服务网格或者其他架构风格，涉及与远程
服务交互时，服务的注册发现、跟踪治理、负载均衡、故障隔离、认证授权、伸缩扩展、
传输通讯、事务处理，等等，这一系列问题都是无可避免的
# 不可变基础设施
- 
# 技术方法论
# 随笔
Redission 这个需要注意一下